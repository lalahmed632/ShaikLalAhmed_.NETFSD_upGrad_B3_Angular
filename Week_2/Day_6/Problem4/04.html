<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Expense Tracker</title>
</head>
<body>

<div class="container">
    <h2>Mini Expense Tracker</h2>

    <input type="text" id="title" placeholder="Expense Title">
    <input type="number" id="amount" placeholder="Amount">
    <input type="date" id="date">

    <button onclick="addExpense()">Add Expense</button>
    <button onclick="viewExpenses()">View Expenses</button>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Amount</th>
                <th>Date</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="expenseList"></tbody>
    </table>
</div>

<script>
let db;

let request = indexedDB.open("ExpenseDB", 1);

request.onupgradeneeded = function(e){
    db = e.target.result;
    db.createObjectStore("expenses", { keyPath: "id", autoIncrement: true });
};

request.onsuccess = function(e){
    db = e.target.result;
    viewExpenses();
};

request.onerror = function(e){
    alert("Database Error");
};

function addExpense(){
    let title = document.getElementById("title").value;
    let amount = document.getElementById("amount").value;
    let date = document.getElementById("date").value;

    if(title === "" || amount === "" || date === ""){
        alert("Please fill all fields");
        return;
    }

    let transaction = db.transaction(["expenses"], "readwrite");
    let store = transaction.objectStore("expenses");

    store.add({ title:title, amount:amount, date:date });

    transaction.oncomplete = function(){
        viewExpenses();
    };

    transaction.onerror = function(){
        alert("Transaction Error");
    };

    document.getElementById("title").value = "";
    document.getElementById("amount").value = "";
    document.getElementById("date").value = "";
}

function viewExpenses(){
    let transaction = db.transaction(["expenses"], "readonly");
    let store = transaction.objectStore("expenses");
    let request = store.getAll();

    request.onsuccess = function(){
        let output = "";
        request.result.forEach(function(item){
            output += `
                <tr>
                    <td>${item.id}</td>
                    <td>${item.title}</td>
                    <td>${item.amount}</td>
                    <td>${item.date}</td>
                    <td>
                        <button class="delete-btn" onclick="deleteExpense(${item.id})">
                            Delete
                        </button>
                    </td>
                </tr>
            `;
        });
        document.getElementById("expenseList").innerHTML = output;
    };

    request.onerror = function(){
        alert("Query Error");
    };
}

function deleteExpense(id){
    let transaction = db.transaction(["expenses"], "readwrite");
    let store = transaction.objectStore("expenses");

    store.delete(id);

    transaction.oncomplete = function(){
        viewExpenses();
    };

    transaction.onerror = function(){
        alert("Delete Error");
    };
}
</script>

</body>
</html>